function rcp_validate_form(e){rcp_validate_subscription_level(),e&&rcp_validate_gateways(),rcp_validate_discount()}function rcp_validate_subscription_level(){if(!rcp_validating_level){var e=jQuery,a=!1,r=e("#rcp_subscription_levels input:checked"),c=e(".rcp_gateway_fields").hasClass("rcp_discounted_100"),t="forever"==r.data("duration");rcp_validating_level=!0,0==r.attr("rel")&&(a=!0),a?(e(".rcp_gateway_fields,#rcp_auto_renew_wrap,#rcp_discount_code_wrap").hide(),e(".rcp_gateway_fields").removeClass("rcp_discounted_100"),e("#rcp_discount_code_wrap input").val(""),e(".rcp_discount_amount,#rcp_gateway_extra_fields").remove(),e(".rcp_discount_valid, .rcp_discount_invalid").hide(),e("#rcp_auto_renew_wrap input").attr("checked",!1)):(c?e("#rcp_gateway_extra_fields").remove():t?(e("#rcp_auto_renew_wrap input").attr("checked",!1),e("#rcp_auto_renew_wrap").hide()):e(".rcp_gateway_fields,#rcp_auto_renew_wrap").show(),e("#rcp_discount_code_wrap").show()),rcp_validating_level=!1}}function rcp_get_gateway(){var e,a=jQuery;return a("#rcp_payment_gateways").length>0?(e=a("#rcp_payment_gateways select option:selected"),e.length<1&&(e=a('input[name="rcp_gateway"]:checked'))):e=a('input[name="rcp_gateway"]'),e}function rcp_validate_gateways(){if(!rcp_validating_gateway){var e=jQuery,a=e("#rcp_registration_form"),r=!1,c=e("#rcp_subscription_levels input:checked"),t=e(".rcp_gateway_fields").hasClass("rcp_discounted_100"),_="forever"==c.data("duration"),i=rcp_get_gateway();if(rcp_validating_gateway=!0,0==c.attr("rel")&&(r=!0),e(".rcp_message.error",a).remove(),r)e(".rcp_gateway_fields").hide(),e("#rcp_auto_renew_wrap").hide(),e("#rcp_auto_renew_wrap input").attr("checked",!1),e("#rcp_gateway_extra_fields").remove();else{if(t)e("#rcp_gateway_extra_fields").remove();else{a.block({message:rcp_script_options.pleasewait,css:{border:"none",padding:"15px",backgroundColor:"#000","-webkit-border-radius":"10px","-moz-border-radius":"10px",opacity:.5,color:"#fff"}}),e(".rcp_gateway_fields").show();var p={action:"rcp_load_gateway_fields",rcp_gateway:i.val()};e.post(rcp_script_options.ajaxurl,p,function(r){e("#rcp_gateway_extra_fields").remove(),r.success&&r.data.fields&&(e(".rcp_gateway_fields").length?e('<div class="rcp_gateway_'+i.val()+'_fields" id="rcp_gateway_extra_fields">'+r.data.fields+"</div>").insertAfter(".rcp_gateway_fields"):e('<div class="rcp_gateway_'+i.val()+'_fields" id="rcp_gateway_extra_fields">'+r.data.fields+"</div>").insertAfter(".rcp_gateways_fieldset")),a.unblock()})}"yes"!=i.data("supports-recurring")||t||_?(e("#rcp_auto_renew_wrap").hide(),e("#rcp_auto_renew_wrap input").attr("checked",!1)):e("#rcp_auto_renew_wrap").show(),e("#rcp_discount_code_wrap").show()}rcp_validating_gateway=!1}}function rcp_validate_discount(){if(!rcp_validating_discount){var e=jQuery,a=e(".rcp_gateway_fields"),r=e("#rcp_discount_code").val();if(e("#rcp_subscription_levels input:checked").length)var c=e("#rcp_subscription_levels input:checked").val();else var c=e('input[name="rcp_level"]').val();if(r){var t={action:"validate_discount",code:r,subscription_id:c};rcp_validating_discount=!0,e.post(rcp_script_options.ajaxurl,t,function(r){e(".rcp_discount_amount").remove(),e(".rcp_discount_valid, .rcp_discount_invalid").hide(),r.valid?r.valid&&(e(".rcp_discount_valid").show(),e("#rcp_discount_code_wrap label").append('<span class="rcp_discount_amount"> - '+r.amount+"</span>"),r.full?(e("#rcp_auto_renew_wrap").hide(),a.hide().addClass("rcp_discounted_100"),e("#rcp_gateway_extra_fields").remove()):(e("#rcp_auto_renew_wrap").show(),a.show().removeClass("rcp_discounted_100"),rcp_validate_gateways())):(e(".rcp_discount_invalid").show(),a.removeClass("rcp_discounted_100"),e(".rcp_gateway_fields,#rcp_auto_renew_wrap").show()),rcp_validating_discount=!1,e("body").trigger("rcp_discount_applied",[r])})}}}function rcp_calc_total(){var e=jQuery,a=e(".rcp_registration_total"),r=e("#rcp_discount_code").val(),c=e("#rcp_subscription_levels input:checked").length?e("#rcp_subscription_levels input:checked").val():e('input[name="rcp_level"]').val(),t=rcp_get_gateway();if(a.length){rcp_calculating_total=!0;var _={action:"rcp_calc_discount",rcp_level:c,rcp_discount:r,rcp_gateway:t.val()};e("#rcp_auto_renew").is(":checked")&&(_.rcp_auto_renew=!0),e.post(rcp_script_options.ajaxurl,_,function(e){rcp_calculating_total=!1,void 0!==e.total&&a.html(e.total)})}}var rcp_validating_discount=!1,rcp_validating_gateway=!1,rcp_validating_level=!1,rcp_processing=!1,rcp_calculating_total=!1;jQuery(document).ready(function(e){rcp_validate_form(!0),rcp_calc_total(),e("#rcp_payment_gateways select, #rcp_payment_gateways input").change(function(){e("body").trigger("rcp_gateway_change")}),e(".rcp_level").change(function(){e("body").trigger("rcp_level_change")}),e("body").on("rcp_gateway_change",function(){rcp_validate_form(!0)}).on("rcp_level_change",function(){rcp_validate_form(!0)}),e("#rcp_apply_discount").on("click",function(a){a.preventDefault(),e("body").trigger("rcp_discount_change"),rcp_validate_discount()}),e(document.getElementById("rcp_auto_renew")).on("change",rcp_calc_total),e("body").on("rcp_discount_change rcp_level_change rcp_gateway_change",rcp_calc_total),e(document).on("click","#rcp_registration_form #rcp_submit",function(a){var r=document.getElementById("rcp_registration_form"),c=e("#rcp_registration_form");if("function"!=typeof r.checkValidity||!1!==r.checkValidity()){a.preventDefault();var t=e(this).val();c.block({message:rcp_script_options.pleasewait,css:{border:"none",padding:"15px",backgroundColor:"#000","-webkit-border-radius":"10px","-moz-border-radius":"10px",opacity:.5,color:"#fff"}}),e("#rcp_submit",c).val(rcp_script_options.pleasewait),rcp_processing||(rcp_processing=!0,e.post(rcp_script_options.ajaxurl,c.serialize()+"&action=rcp_process_register_form&rcp_ajax=true",function(a){e(".rcp-submit-ajax",c).remove(),e(".rcp_message.error",c).remove(),a.success?(e("body").trigger("rcp_register_form_submission"),e(r).submit()):(e("#rcp_submit",c).val(t),e("#rcp_submit",c).before(a.data.errors),e("#rcp_register_nonce",c).val(a.data.nonce),c.unblock(),rcp_processing=!1)}).done(function(e){}).fail(function(e){console.log(e)}).always(function(e){}))}})});